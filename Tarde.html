<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="noche.css">
    <title>Reporte Procesado</title>
    
</head>
<body>
    <h1>Registro De Unidades Para Viaje De Pollo Gordo</h1>

    <div class="unidad-folio">
        <label for="unidadpro">No. de Unidad:</label>
        <input type="tel" id="unidadpro" inputmode="numeric" pattern="[0-9]*" required>

        <label for="foliopro">Folio:</label>
        <input type="tel" id="foliopro" inputmode="numeric" pattern="[0-9]*" required>

        <label for="notapro" style="display: none;">NOTA:</label>
        <input type="text" id="notapro" style="display: none;" required>
    </div>

    <button onclick="agregarViaje()">Agregar Folio</button>
    <button onclick="copiar()">Copiar</button>

    <h2>Resultado</h2>
    <p id="resultado"></p>
    
    <script>
        let unidadesFolios = [];
        let unidadesCanceladas = [];
        let unidadesPendientes = [];
        let unidadesTaller = []; // Unidades que van al taller
        let unidadesConbu = [];

function obtenerFechaActual() {
    const hoy = new Date();
    const dia = String(hoy.getDate()).padStart(2, '0');
    const mes = String(hoy.getMonth() + 1).padStart(2, '0');
    const a√±o = hoy.getFullYear().toString().slice(-2);
    return `${dia}/${mes}/${a√±o}`;
}

let folioActual = null;

function agregarViaje() {
    const unidadpro = document.getElementById('unidadpro').value.trim();
    const foliopro = document.getElementById('foliopro').value.trim();

    if (unidadpro !== "" && (folioActual !== null || foliopro !== "")) {
        let tracto = "";

        if (folioActual === null) {
            folioActual = parseInt(foliopro);
        }

        if (unidadpro.startsWith("0")) {
            tracto = prompt("Ingrese el n√∫mero del tracto:").trim();
        }

        unidadesFolios.push({ unidadpro, foliopro: folioActual.toString(), tracto });
        folioActual++;

        document.getElementById('unidadpro').value = "";
        document.getElementById('foliopro').value = "";
        document.getElementById('unidadpro').focus();

        if (confirm("¬øDesea agregar otro viaje?")) {
            agregarViaje();
        } else {
            folioActual = null;
            preguntarPendientes();
        }
    }
}

function preguntarPendientes() {
    if (confirm("¬øHay unidades pendientes por liberar?")) {
        let unidadesPendientesInput = prompt("Ingrese las unidades pendientes, separadas por un espacio", "");
        if (unidadesPendientesInput) {
            unidadesPendientes = unidadesPendientesInput.split(" ").map(item => item.trim());
        }
    }
    preguntarCancelados();
}

function preguntarCancelados() {
    if (confirm("¬øHay unidades o folios cancelados?")) {
        let unidadesCanceladasInput = prompt("Ingrese las unidades", "");
        if (unidadesCanceladasInput) {
            unidadesCanceladas = unidadesCanceladasInput.split(" ").map(item => item.trim());
        }
    }
    preguntarTaller();
}

function preguntarTaller(){
    if (confirm("¬øHay unidades que salieron a taller?")){
        let unidadesTallerInput = prompt("Ingrese las unidades", "");
        if(unidadesTallerInput){
            unidadesTaller = unidadesTallerInput.split(" ").map(item => item.trim());
        }
    }
    valecom();
}

function valecom(){
    if (confirm("¬øSe otorgo vale para carga de combustible?")){
        let combusvale = prompt("Ingrese las unidades, separadas por un espacio", "");
        if (combusvale){
            unidadesConbu = combusvale.split(" ").map(item => item.trim());
        }
    }
    mostrarResultado();
}

function mostrarResultado() {
    if (unidadesFolios.length == 0) {
        document.getElementById('resultado').innerHTML = "No se han agregado unidades y folios.";
        return;
    }
    
    const numeroviaje = unidadesFolios.length - unidadesTaller.length - unidadesCanceladas.length - unidadesConbu.length;
    const fechaActual = obtenerFechaActual();

    let resultado = `*üêìREJAS*<br>*üóì${fechaActual}*<br><br>`;
    resultado += `*UNIDADES LIBERADAS PARA VIAJE DE POLLO GORDO*<br><br>`;

    unidadesFolios.forEach(item => {
        if (
            !unidadesCanceladas.includes(item.unidadpro)&&
            !unidadesPendientes.includes(item.unidadpro)&&
            !unidadesTaller.includes(item.unidadpro)&&
            !unidadesConbu.includes(item.unidadpro)
        ) {
            resultado += item.unidadpro.startsWith("0") ? `*‚Ä¢ VP-${item.unidadpro.padStart(3, '0')}* 
            Tracto: *${item.tracto.toUpperCase()}* Folio: *${item.foliopro}*<br>` : `*‚Ä¢ V-0${item.unidadpro}* 
            Folio: *${item.foliopro}*<br>`;
            //<input type="checkbox" class="resultado-checkbox" data-unidad="${item.unidadpro}" data-folio="${item.foliopro}"><br>`;
        }
    });

    resultado += `<br>*‚úÖ¬°${numeroviaje} VIAJES EN TOTAL DE POLLO GORDO!üêîüöõ*<br><br>`;

    if (unidadesPendientes.length > 0) {
        resultado +=`<br>‚è≥ *UNIDADES PENDIENTES POR LIBERAR:*<br>`;
        unidadesPendientes.forEach(pendiente => {
            if (pendiente.startsWith('0')) {
                resultado += `‚Ä¢ VP-${pendiente.padStart(3, '0')}<br>`;
            } else {
                resultado += `‚Ä¢ V-0${pendiente}<br>` 
            }
        });
    }


    if (unidadesCanceladas.length > 0) {
        resultado += `üìù Nota:<br>` + `<br>‚ùå *FOLIOS CANCELADOS:*<br>`;
        unidadesCanceladas.forEach(cancelado => {
            const index = unidadesFolios.findIndex(item => item.unidadpro == cancelado);
            if (index !== -1){
                resultado += `‚Ä¢ V-0${cancelado} Folio: ${unidadesFolios[index].foliopro}<br>`;
            }
            else{
            resultado += `‚Ä¢ V-0${cancelado} Folio: No Encontrado<br>`;
        }
        });
    }

    if (unidadesTaller.length > 0){
        resultado += `<br>üîß‚öôÔ∏è *UNIDADES QUE SE LIBERAR√ìN PARA TALLER:*<br>`;
        unidadesTaller.forEach(taller =>{
            const index  = unidadesFolios.findIndex(item => item.unidadpro == taller);
            if (index !== -1){
                resultado += `‚Ä¢ V-0${taller} Folio: ${unidadesFolios[index].foliopro}<br>`;
            }
            else{
                resultado += `‚Ä¢ V-0${taller} Folio: No Encontrado<br>`;
            }
            
        });
    }

    if (unidadesConbu.length > 0){
        resultado += `<br>‚õΩ *UNIDADES QUE SE LES OTORGO VALE PARA CARGA DE COMBUSTIBLE:*<br>`;
        unidadesConbu.forEach(carga => {
            const index = unidadesFolios.findIndex(item => item.unidadpro == carga);
            if (index !== -1){
                resultado += `‚Ä¢ V-0${carga} Folio:${unidadesFolios[index].foliopro}<br>`;
            }
            else{
                resultado += `‚Ä¢ V-0${carga} Folio: No Encontrado<br>`;
            }
        });
    }

    document.getElementById('resultado').innerHTML = resultado;
}

function copiar() {
    const resultado = document.getElementById('resultado').innerText;
    const textarea = document.createElement('textarea');
    textarea.value = resultado;
    document.body.appendChild(textarea);
    textarea.select();
    document.execCommand('copy');
    document.body.removeChild(textarea);
    alert('Copiado');
}

document.addEventListener('DOMContentLoaded', () => {
    document.addEventListener('keydown', (event) => {
        if (event.key === 'Enter') {
            event.preventDefault();
            agregarViaje();
        }
    });
});
</script>
</body>
</html>



